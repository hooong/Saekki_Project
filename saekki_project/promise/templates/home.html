{% extends 'base.html' %}
{% load staticfiles %}
{% block contents %}

{% load socialaccount %}
{% get_social_accounts user as accounts %}

<link rel="stylesheet" href="{% static 'promise/css/homeLandscape.css' %}">

<script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>

<svg version="1.1" xmlns="http://www.w3.org/2000/svg">
    <filter id="blur">
        <feGaussianBlur stdDeviation="6" />
    </filter>
</svg>



<body>
        
        

        <div id="homeRightCon">
                <div id="myProfiles">
                        <!-- 프로필 사진 보여주기 -->
                        <div>
                            {% if not user.socialaccount_set.all %}
                            {% if not user.profile %}
                            <img style="border-radius:50%" width="60" height="60" src="{% static 'promise/user.png' %}" />
                            {% elif user.profile.image == '' %}
                            <img style="border-radius:50%" width="60" height="60" src="{% static 'promise/user.png' %}" />
                            {% else %}
                                <img width="60" height="60" src="{{ user.profile.image.url }}" />
                            {% endif %}
                            {% else %}
                            <img style="border-radius:50%"width="60" height="60" src="{{ user.socialaccount_set.all.0.get_avatar_url }}" />
                            {% endif %}
                        </div>
                        <div id="myProfileNames">
                        {{user.username}}<br>
                        <div id="myProfileIns">{{ user.profile.state_msg }}</div>
                        
                        </div>
                        </div>
                    
                        <div class="menu_tabs">
                                
                            <ul>
                                    {% if noti_add_friend %}
                                    <span id="newControls">
                                    <span id="newFriendNews">new</span>
                                    <span id="newFirendBts"></span>
                                        </span>
                                        {% endif %}
                                <li class="actives"><a href="#"; onclick="tab_menus(0);">친구신청</a></li>
                                <li><a href="#" onclick="tab_menus(1);">몰라시발</a></li>
                            </ul>
                        </div>
                        <div class="menu_tabs0" id="panels" >
                                {% if not noti_add_friend %}
                                    너는 친구도없니? <br>
                                {% endif %}
                                {% for noti in noti_add_friend %}
                                    <strong style="color:#D84339">{{noti.send_user}}</strong>님께서 친구 신청을 하였습니다. 
                                    <a href="{% url 'change_friend' operation='ok' pk=noti.send_user.id %}">수락</a> | <a href="{% url 'change_friend' operation='deny' pk=noti.send_user.id %}">거절</a><br>
                    
                                {% endfor %}
                        
                        </div>
                        <div class="menu_tabs1" id="panels" style="display:none;">1번내용란</div>
                        
                        <script>
                        function tab_menus(num){
                            var f = $('.menu_tabs').find('li');
                            for(var i =0; i<f.length; i++){
                                if(i==num){
                                    f.eq(i).addClass('actives');
                                    $('.menu_tabs' + i).show();
                                }else{
                                    f.eq(i).removeClass('actives');
                                    $('.menu_tabs' + i).hide();
                                }
                            }
                        }
                        </script>
            
        </div>

        <a href="{% url 'search' %}"> 회원검색 </a>

        <h2>약속 댓글 알림</h2>
        {% for noti in noti_promise %}
            {% if noti.com_or_pro == 'p' %}
            
                <a href="{% url 'noti_promise_button' operation='click' pk=noti.id %}">{{noti.send_user}}님이 {{noti.promise.title}}에 초대했습니다.</a> <br>
                <a href="{% url 'noti_promise_button' operation='delete' pk=noti.id %}"><button>지우기</button></a>
            {% elif noti.com_or_pro == 'c' %}
                <a href="{% url 'noti_promise_button' operation='click' pk=noti.id %}">{{noti.send_user}}님이 {{noti.promise.title}}에 댓글을 남겼습니다.</a> <br>
                <a href="{% url 'noti_promise_button' operation='delete' pk=noti.id %}"><button>지우기</button></a>
            {% endif %}
        {% endfor %}
            

        <!-- 모든 사용자 띄우기(super유저는 친구목록이 안뜸) -->
        <h2>Other People</h2>
        {% for user in users %}
            <!-- 프사 띄워주는 곳 -->
            {% if not user.socialaccount_set.all %}
                {% if not user.profile %}
                    스태틱
                {% elif user.profile.image == '' %}
                    스태틱
                {% else %}
                    <img width="50" height="50" src="{{ user.profile.image.url }}" />
                {% endif %}
            {% else %}
            <img width="50" height="50" src="{{ user.socialaccount_set.all.0.get_avatar_url }}" />
            {% endif %}
            {{ user.username }}
            {% if user not in friends %}
                {% if user.username in noti_wait_friend %}
                <button>요청중</button>
                {% else %}
                <a href="{% url 'add_friend' pk=user.pk %}">
                    <button>친구신청</button>
                </a>
                {% endif %}
            {% endif %}
            <br>
        {% endfor %}

        <!-- 친구목록 -->
        <h2>friends</h2>
        {% for friend in friends %}
            {% if not friend.socialaccount_set.all %}
                {% if not friend.profile %}
                    스태틱
                {% elif friend.profile.image == '' %}
                    스태틱
                {% else %}
                    <img width="50" height="50" src="{{ friend.profile.image.url }}" />
                {% endif %}
            {% else %}
            <img width="50" height="50" src="{{ friend.socialaccount_set.all.0.get_avatar_url }}" />
            {% endif %}

        {{ friend.username }}
        {% if friend.profile and friend.profile.state_msg != None %}
            {{friend.profile.state_msg}}
        {% endif %}
        <a href="{% url 'change_friend' operation='remove' pk=friend.pk %}">
            <button>친구해제</button>
        </a>
        <br>
        {% endfor %}
        <!-- 약속게시물 -->
        <div>
        <h2 >Promise(진행중인 약속)</h2>
        <!-- 도착 -->
        {% for arrive in arrives %}
            {% if arrive.promise.end == 0 %}
                    <a href="{% url 'detail' pk=arrive.promise.id %}">
                        <div>
                            {{arrive.promise.title}} <br>
                            {{arrive.promise.setting_date_time}} <br>
                            (도착) <br>
                        </div>      
                    </a>
            {% endif %}
        {% endfor %}
    </div>
        <hr> 
        <!-- 미도착 -->
        {% for no_arrive in no_arrives %}
            {% if no_arrive.promise.end == 0 %}
                    
                            <div id="{{no_arrive}}" class="prl bgBlur test">
                                <a href="{% url 'detail' pk=no_arrive.promise.id %}">
                                    <div class="promiseCard">  {{no_arrive.promise.title}}</div>
                                        <span>{{no_arrive.promise.setting_date_time}}(미도착)</span>
                                        <a href="{% url 'detail' pk=no_arrive.promise.id %}"></a>
                                        <script>
                                                function handler(ev){
                                                    var target= $(ev.target);
                                                    var elId = target.attr('id');
                                                    if(target.is(".prl *")){
                                                        $(this).css("box-shadow", "15px 15px 15px rgb(138,148,145)");
                                                        $(this).css("margin", "8px 12px 12px 8px ");
                                                    }
                                                }
                                            $(".prl").mouseover(handler);
                                            function hand(ev){
                                                    var target= $(ev.target);
                                                    var elId = target.attr('id');
                                                    if(target.is(".prl *")){
                                                    $(this).css("box-shadow", "10px 10px 10px rgb(138,148,145)");
                                                    $(this).css("margin", "10px");
                                                    }
                                                }
                                            $(".prl").mouseleave(hand);
                                            </script>
                                
                                </div>   
                           
                    </a>
            {% endif %}
        {% endfor %}      
                


 <style type="text/css">
            .prl{
                margin:10px;
                border-radius:3px;
                box-shadow:10px 10px 10px rgb(138, 148, 145);
                text-align: center;
                padding:20px;
            }
            .prl a:hover{text-decoration:none;}


</style>


    <div>
        <h2 >Promise(시간이 지난 약속)</h2>
        {% for promise in promises %}
        {% if user.username == promise.user.username or user.username in promise.party %}
        {% if promise.end == 1 %}
       
        
            
            <div id="{{promise}}" class="prl bgBlur test" style="display:inline-block; margin:10px;">
                    <a href="{% url 'detail' pk=promise.id %}">
                <div class="promiseCard">{{promise.title}}</div>
                <span>{{promise.setting_date_time}}</span>
            </a>
            
            </div>   
     
                <script>
                    function handler(ev){
                        var target= $(ev.target);
                        var elId = target.attr('id');
                        if(target.is(".prl")){
                            $(this).css("box-shadow", "15px 15px 15px rgb(138,148,145)");
                            $(this).css("margin", "8px 12px 12px 8px ");
                            
                        }
                    }
                $(".prl").mouseover(handler);
                function hand(ev){
                        var target= $(ev.target);
                        var elId = target.attr('id');
                        if(target.is(".prl")){
                        $(this).css("box-shadow", "10px 10px 10px rgb(138,148,145)");
                        $(this).css("margin", "10px");
                        }
                    }
                $(".prl").mouseleave(hand);
                </script>
   
                {%endif%}
                {% endif %}
    {% endfor %}
</div>



    </div>
                    

 



























</body>
{% endblock %}

