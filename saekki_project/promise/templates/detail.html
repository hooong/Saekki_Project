<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1e1e43d51246b484ff2b8c4980dc005b&libraries=services"></script>

<!-- 도착이벤트 -->
<form method="POST" action="{% url 'arrived' promise.id %}">
    {% csrf_token %}
    <button type="submit">도착했어요!</button>
</form>
    <br><br>

    
제목 : {{promise.title}} <br>
글쓴이 : {{promise.user}} <br>
작성시간 : {{promise.created_at}} <br>
내용 : {{promise.content}} <br>
약속시간 : {{promise.setting_date_time}} <br>
참가원 : 
{% for party in promise.party %}
{{party}}
{% endfor %} <br>
약속장소 : <div id="map" style="width:500px;height:400px;"></div>

<!-- TODO
    - 현재 도착한사람 보여주기
-->

<script> 

        
    var infowindow = new kakao.maps.InfoWindow({zIndex:1});

    var lng = '{{promise.longitud}}';
    var lat = '{{promise.latitude}}';

    var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = {
            //TODO : 위치기반 현재 위치 따오기 만약 위치서비스 안쓸경우도 대비
            center: new kakao.maps.LatLng(lat, lng), // 지도의 중심좌표
            level: 3 // 지도의 확대 레벨
        };  

    // 지도를 생성합니다    
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 마커가 표시될 위치입니다 
    var markerPosition  = new kakao.maps.LatLng(lat, lng); 

    // 마커를 생성합니다
    var marker = new kakao.maps.Marker({
        position: markerPosition
    });

    // 마커가 지도 위에 표시되도록 설정합니다
    marker.setMap(map);

    var iwContent = '<div style="padding:5px;">약속장소</div>', // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
        iwRemoveable = true; // removeable 속성을 ture 로 설정하면 인포윈도우를 닫을 수 있는 x버튼이 표시됩니다

    // 인포윈도우를 생성합니다
    var infowindow = new kakao.maps.InfoWindow({
        content : iwContent,
        removable : iwRemoveable
    });

    // 마커에 클릭이벤트를 등록합니다
    kakao.maps.event.addListener(marker, 'click', function() {
        // 마커 위에 인포윈도우를 표시합니다
        infowindow.open(map, marker);  
    });
</script>