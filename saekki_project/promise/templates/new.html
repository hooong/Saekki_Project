{% load staticfiles %}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />
<!-- 지도 api key -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1e1e43d51246b484ff2b8c4980dc005b&libraries=services"></script>

<head>
    <!-- 지도관련 script -->
    <script>
    var infowindow = new kakao.maps.InfoWindow({zIndex:1});

    function init()
    {
        window.navigator.geolocation.getCurrentPosition(current_position);
    }

    function current_position(position)
    {
    
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                //TODO : 위치기반 현재 위치 따오기 만약 위치서비스 안쓸경우도 대비
                center: new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };  

        // 지도를 생성합니다    
        var map = new kakao.maps.Map(mapContainer, mapOption); 
    
        // 주소 - 좌표 변환 객체
        var geocoder = new kakao.maps.services.Geocoder();

        var marker = new kakao.maps.Marker(); // 클릭한 위치를 표시할 마커입니다

        // 현재 지도 중심좌표로 주소를 검색해서 지도 좌측 상단에 표시합니다
        searchAddrFromCoords(map.getCenter(), displayCenterInfo);

        // 지도를 클릭했을 때 클릭 위치 좌표에 대한 주소정보를 표시하도록 이벤트를 등록합니다
        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
            searchDetailAddrFromCoords(mouseEvent.latLng, function(result, status) {
                if (status === kakao.maps.services.Status.OK) {
                    var detailAddr = !!result[0].road_address ? '<div>도로명주소 : ' + result[0].road_address.address_name + '</div>' : '';
                    detailAddr += '<div>지번 주소 : ' + result[0].address.address_name + '</div>';
                    
                    var content = '<div class="bAddr">' +
                                    '<span class="title">주소</span>' + 
                                    detailAddr + 
                                '</div>';
                    
                    var latlng = mouseEvent.latLng;
                    // 마커를 클릭한 위치에 표시합니다 
                    marker.setPosition(latlng);
                    marker.setMap(map);

                    var lat = latlng.getLat();
                    var lng = latlng.getLng();

                    document.new_form.addr_lat.value = lat
                    document.new_form.addr_lng.value = lng

                    // 인포윈도우에 클릭한 위치에 대한 법정동 상세 주소정보를 표시합니다
                    infowindow.setContent(content);
                    infowindow.open(map, marker);
                }   
            });
        });

        // 중심 좌표나 확대 수준이 변경됐을 때 지도 중심 좌표에 대한 주소 정보를 표시하도록 이벤트를 등록합니다
        kakao.maps.event.addListener(map, 'idle', function() {
            searchAddrFromCoords(map.getCenter(), displayCenterInfo);
        });

        function searchAddrFromCoords(coords, callback) {
            // 좌표로 행정동 주소 정보를 요청합니다
            geocoder.coord2RegionCode(coords.getLng(), coords.getLat(), callback);         
        }

        function searchDetailAddrFromCoords(coords, callback) {
            // 좌표로 법정동 상세 주소 정보를 요청합니다
            geocoder.coord2Address(coords.getLng(), coords.getLat(), callback);
        }

        // 지도 좌측상단에 지도 중심좌표에 대한 주소정보를 표출하는 함수입니다
        function displayCenterInfo(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                var infoDiv = document.getElementById('centerAddr');

                for(var i = 0; i < result.length; i++) {
                    // 행정동의 region_type 값은 'H' 이므로
                    if (result[i].region_type === 'H') {
                        infoDiv.innerHTML = result[i].address_name;
                        break;
                    }
                }
            }    
        }
    }
    window.addEventListener("load", init);
    </script>
</head>

<form method="POST" name='new_form'>
    {% csrf_token %}
    <table>
        {{ form.as_table }}
    </table>

    <!-- 참여인원 input -->
    {% for friend in friends %}
    <input type="checkbox" name="party_friend[]" value="{{friend}}"> {{friend.username}}<br>
    {% endfor %}

    <!-- 날짜시간선택__ -->
    <div class="css-script-clear"></div>

        <div class="container">
        <h1>tail.DateTime Datetime Picker Demos</h1>
        <div class="row">
            <div class="col-lg-6">
        <h2>Datetime Picker</h2>
        <input type="text" id="datetimeDemo" class="datetime form-control" />
        <div id="datetime-demo-holder" class="datetime-folder"></div>
        </div>

        </div>
        </div>

    <script>
        tail.DateTime("#datetimeDemo", {
            static: "#datetime-demo-holder",   /* Used for demonstration */
            classNames: "theme-default",    /* Used for demonstration */
            startOpen: true,                /* Used for demonstration */
            stayOpen: true,                 /* Used for demonstration */
            position: "#datetime-demo-holder", 

        });

        var month = new Date().getMonth();
    
    </script>

    <!-- 위도 경도 input -->
    <input type="hidden" name='addr_lat' value=''>
    <input type="hidden" name='addr_lng' value=''>

    <!-- 지도 띄우기 -->
    <div id="map" style="width:500px;height:400px;"></div>

    <button type='submit'>확인</button>
</form>







